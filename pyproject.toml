[build-system]
requires = ["scikit-build-core>=0.10", "pybind11>=2.11", "numpy>=1.19"]
build-backend = "scikit_build_core.build"

[project]
name = "audaspace"
version = "1.8.0"
description = "Audaspace is a high level audio library."
readme = "README.md"
license = {text = "Apache License 2.0"}
authors = [
    {name = "Jörg Müller", email = "nexyon@gmail.com"}
]
requires-python = ">=3.8"
dependencies = ["numpy>=1.19.0"]
keywords = ["audio", "sound", "3d-audio", "spatial-audio", "ffmpeg"]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Developers",
    "License :: OSI Approved :: Apache Software License",
    "Operating System :: MacOS :: MacOS X",
    "Operating System :: Microsoft :: Windows",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: C++",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.8",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Topic :: Multimedia :: Sound/Audio",
]

[project.urls]
Homepage = "https://github.com/audaspace/audaspace"
Documentation = "https://audaspace.github.io"
Repository = "https://github.com/audaspace/audaspace"
Issues = "https://github.com/audaspace/audaspace/issues"

[tool.scikit-build]
cmake.verbose = true
cmake.build-type = "Release"
minimum-version = "0.10"
build-dir = "build/{wheel_tag}"
wheel.packages = []

[tool.scikit-build.cmake.define]
# Disable non-essential components
BUILD_DEMOS = "OFF"
WITH_DOCS = "OFF"
WITH_BINDING_DOCS = "OFF"
WITH_C = "ON"
SEPARATE_C = "OFF"
SHARED_LIBRARY = "ON"
AUDASPACE_STANDALONE = "OFF"

# Enable Python module with scikit-build
WITH_PYTHON = "ON"
WITH_PYTHON_MODULE = "OFF"
SKBUILD = "1"

# Enable audio backends (static linking)
WITH_FFMPEG = "ON"
WITH_LIBSNDFILE = "ON"
WITH_OPENAL = "ON"
WITH_SDL = "ON"
WITH_FFTW = "ON"
USE_SDL2 = "ON"

# Disable plugins (embed everything statically)
PLUGIN_FFMPEG = "OFF"
PLUGIN_LIBSNDFILE = "OFF"
PLUGIN_OPENAL = "OFF"
PLUGIN_SDL = "OFF"

# Platform-specific backends
[[tool.scikit-build.overrides]]
if.platform-system = "linux"
cmake.define.WITH_JACK = "ON"
cmake.define.WITH_PULSEAUDIO = "ON"
cmake.define.WITH_PIPEWIRE = "ON"
cmake.define.PLUGIN_JACK = "OFF"
cmake.define.PLUGIN_PULSEAUDIO = "OFF"
cmake.define.PLUGIN_PIPEWIRE = "OFF"

[[tool.scikit-build.overrides]]
if.platform-system = "darwin"
cmake.define.WITH_COREAUDIO = "ON"
cmake.define.PLUGIN_COREAUDIO = "OFF"
cmake.define.CMAKE_OSX_DEPLOYMENT_TARGET = "11.0"

[[tool.scikit-build.overrides]]
if.platform-system = "win32"
cmake.define.WITH_WASAPI = "ON"
cmake.define.PLUGIN_WASAPI = "OFF"

[tool.cibuildwheel]
build = "cp38-* cp39-* cp310-* cp311-* cp312-* cp313-*"
skip = "*-musllinux* pp*"
test-requires = ["numpy"]
test-command = "python {project}/test_wheel.py"

[tool.cibuildwheel.linux]
manylinux-x86_64-image = "manylinux2014"
before-all = [
    "yum install -y epel-release",
    "yum install -y cmake3 pkg-config",
]
repair-wheel-command = "auditwheel repair -w {dest_dir} {wheel}"

[tool.cibuildwheel.macos]
environment = {MACOSX_DEPLOYMENT_TARGET="11.0"}
repair-wheel-command = "delocate-wheel --require-archs {delocate_archs} -w {dest_dir} -v {wheel}"

[tool.cibuildwheel.windows]
repair-wheel-command = "delvewheel repair -w {dest_dir} {wheel}"
